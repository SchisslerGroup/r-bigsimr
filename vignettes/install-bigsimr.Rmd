---
title: "Installation and Setup"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Installation and Setup}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)

options(use_jax = FALSE)

set.seed(2020-12-23)
```

## Installation

You can install the release version of the package from GitHub using devtools:

```{r, eval=FALSE}
devtools::install_github("SchisslerGroup/bigsimr")
```

or the development version:

```{r, eval=FALSE}
devtools::install_github("SchisslerGroup/bigsimr", ref="develop")
```

then load the package

```{r, eval=FALSE}
library(bigsimr)
```

---

## Python

bigsimr utilizes numpy and JAX python libraries to carry out some of the computationally heavy tasks. This requires that you have a working installation of python on your machine that can be found in the PATH. To check you can call

```{r, eval=FALSE}
reticulate::py_available()
```

or the bigsimr helper function

```{r, eval=FALSE}
have_python()
```

If your system does not have python, you can install it simply with [Anaconda](https://www.anaconda.com/products/individual) or [Miniconda](https://docs.conda.io/en/latest/miniconda.html)^[a lightweight command line version of Anaconda].

### numpy and JAX

If you install Python with Anaconda or Miniconda, you can install the necessary python libraries with:

```{r, eval=FALSE}
install_bigsimr(method = "conda")
```

This installs the libraries to the "base" conda environment. This should be fine for most users. If you would like finer control, you can create your own virtual environment through the command line or with reticulate:

```{r, eval=FALSE}
reticulate::conda_install(envname = "bigsimr-env",
                          packages = c("numpy", "jax", "jaxlib"),
                          pip = TRUE,
                          conda = "auto",
                          python_version = "3.7")
```

This creates a conda virtual environment called `bigsimr-env` with Python 3.7 and the three necessary libraries. The use of pip is necessary to install JAX. For more in depth JAX installation instructions or to install the GPU version of JAX, please visit the [JAX GitHub](https://github.com/google/jax#installation) page.

To ensure that the bigsimr uses the desired environment, please see the setup section.

---

## Setup

If your Python binary can be discovered by reticulate and has the necessary libraries, then you are good to start using bigsimr! If not, then you can do one of two things: **1)** tell reticulate where to find the Python path for each script, or **2)** edit your `.Rprofile` to set the desired Python path so that it is found each time you launch R.

The following instructions can be found in more detail on [reticulates website](https://rstudio.github.io/reticulate/articles/versions.html).

**First method**

```{r, eval=FALSE}
# Must be set before loading bigsimr
reticulate::use_condaenv("bigsimr-env")
library(bigsimr)

# Do stuff with bigsimr
```


**Second method: .Rprofile**

This will set a default python version each time you load up R or open R from a project folder. You can set the default by user

```{r, eval=FALSE}
usethis::edit_r_profile("user")
```

If using Rstudio, this opens up the `.Rprofile` file for the user. Add the line

```{r, eval=FALSE}
reticulate::use_condaenv("bigsimr-env")
# reticulate::use_python("/usr/local/bin/python")
# reticulate::use_condaenv("myenv")
```

then save and restart your R session. Now whenever you launch R or Rstudio, reticulate will use the specified Python binary.

You can also set the value by project. Open up a project folder in Rstudio.

```{r, eval=FALSE}
usethis::edit_r_profile("project")
```

This creates and opens `.Rprofile` within the project directory. Add the line

```{r, eval=FALSE}
reticulate::use_condaenv("project-env")
# reticulate::use_python("/usr/local/bin/python")
# reticulate::use_condaenv("myenv")
```

then save and restart your R session. Now whenever you open that project, reticulate will know to use a specific conda environment.
